"use strict";

var _interopRequireDefault = require("@babel/runtime-corejs2/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.sortByOrdinalRange = void 0;

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime-corejs2/helpers/toConsumableArray"));

function stringOrFnAccessor(d, accessor) {
  return typeof accessor === "function" ? accessor(d) : d[accessor];
}

var sortByOrdinalRange = function sortByOrdinalRange(oAccessor, rAccessor, secondarySort, data) {
  var subsortData = {};
  var subsortArrays = [];
  data.forEach(function (d) {
    var oD = stringOrFnAccessor(d, oAccessor);

    if (!subsortData[oD]) {
      subsortData[oD] = {
        array: [],
        value: 0,
        label: oD
      };
      subsortArrays.push(subsortData[oD]);
    }

    subsortData[oD].array.push(d);
    subsortData[oD].value += stringOrFnAccessor(d, rAccessor);
  });
  subsortArrays = subsortArrays.sort(function (a, b) {
    if (b.value === a.value) {
      if (a.label < b.label) return -1;
      if (a.label > b.label) return 1;
      return 1;
    }

    return b.value - a.value;
  });

  if (secondarySort !== "none") {
    subsortArrays.forEach(function (a) {
      a.array = a.array.sort(function (a, b) {
        return stringOrFnAccessor(b, secondarySort) - stringOrFnAccessor(a, secondarySort);
      });
    });
  }

  return subsortArrays.reduce(function (p, c) {
    return (0, _toConsumableArray2.default)(p).concat((0, _toConsumableArray2.default)(c.array));
  }, []);
};

exports.sortByOrdinalRange = sortByOrdinalRange;